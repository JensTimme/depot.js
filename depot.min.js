// depot.js v0.1.3 | (c) 2013 Michal Kuklis | Licensed under The MIT License
(function(f,g,e){"object"===typeof exports?module.exports=e():"function"===typeof define&&define.amd?define(e):g[f]=e()})("depot",this,function(){function f(a){return a&&JSON.parse(a)}function g(a,b){var c,d;if("function"==typeof a)c=a(b);else for(d in c=!0,a)c&=a[d]===b[d];return c}function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var h={save:function(a){var b;a[this.idAttribute]||(a[this.idAttribute]=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e());b=a[this.idAttribute];
0>this.ids.indexOf(b)&&(this.ids.push(b),localStorage.setItem(this.name,this.ids.join(",")));localStorage.setItem(this.name+"-"+b,JSON.stringify(a));return a},updateAll:function(a){var b=this.all();b.forEach(function(b){for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);this.save(b)},this);return b},find:function(a){var b,c,d=this.name;return!a?this.all():this.ids.reduce(function(e,h){c=f(localStorage.getItem(d+"-"+h));(b=g(a,c))&&e.push(c);return e},[])},get:function(a){return f(localStorage.getItem(this.name+
"-"+a))},all:function(){var a,b=this.name;return this.ids.reduce(function(c,d){(a=localStorage.getItem(b+"-"+d))&&c.push(f(a));return c},[])},destroy:function(a){var b;b=a[this.idAttribute]?a[this.idAttribute]:a;var c=this.name+"-"+b;a=f(localStorage.getItem(c));localStorage.removeItem(c);b=this.ids.indexOf(b);-1!=b&&this.ids.splice(b,1);localStorage.setItem(this.name,this.ids.join(","));return a},destroyAll:function(a){for(var b,c,d=this.ids.length-1;0<=d;d--)if(b=this.ids[d],b=this.name+"-"+b,a){if(c=
f(localStorage.getItem(b)),c=g(a,c))localStorage.removeItem(b),this.ids.splice(d,1)}else localStorage.removeItem(b);a?localStorage.setItem(this.name,this.ids.join(",")):(localStorage.removeItem(this.name),this.ids=[])},size:function(){return this.ids.length}};return function(a,b){var c,d;if(!localStorage)throw Error("localStorage not found");d=(c=localStorage.getItem(a))&&c.split(",")||[];b=b||{};return Object.create(h,{name:{value:a},store:{value:c},ids:{value:d,writable:!0},idAttribute:{value:b.idAttribute||
"_id"}})}});
