/* ----------------------------------
 * depot.js v0.1.0
 * Licensed under The MIT License
 * http://opensource.org/licenses/MIT
 * ---------------------------------- */

(function(c,e,a){"object"===typeof exports?module.exports=a():"function"===typeof define&&define.amd?define(a):e[c]=a()})("depot",this,function(){function c(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var e={save:function(a){var b;a[this.idAttribute]||(a[this.idAttribute]=c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c());b=a[this.idAttribute];0>this.ids.indexOf(b)&&(this.ids.push(b),localStorage.setItem(this.name,this.ids.join(",")));localStorage.setItem(this.name+"-"+b,
JSON.stringify(a));return a},updateAll:function(a){this.all().forEach(function(b){for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);this.save(b)},this)},find:function(a){var b,d,f,c=this.name;return this.ids.reduce(function(e,g){if(f=localStorage.getItem(c+"-"+g)){f=f&&JSON.parse(f);d=!0;if(a)for(b in a)d&=a[b]==f[b];d&&e.push(f)}return e},[])},get:function(a){return(a=localStorage.getItem(this.name+"-"+a))&&JSON.parse(a)},all:function(){var a,b=this.name;return this.ids.reduce(function(d,c){(a=localStorage.getItem(b+
"-"+c))&&d.push(a&&JSON.parse(a));return d},[])},destroy:function(a){var b;b=a[this.idAttribute]?a[this.idAttribute]:a;localStorage.removeItem(this.name+"-"+b);b=this.ids.indexOf(b);-1!=b&&this.ids.splice(b,1);localStorage.setItem(this.name,this.ids.join(","));return a},destroyAll:function(){this.ids.forEach(function(a){localStorage.removeItem(this.name+"-"+a)},this);localStorage.removeItem(this.name);this.ids=[]}};return function(a,b){var d,c;if(!localStorage)throw Error("localStorage not found");
c=(d=localStorage.getItem(a))&&d.split(",")||[];b=b||{};return Object.create(e,{name:{value:a},store:{value:d},ids:{value:c,writable:!0},idAttribute:{value:b.idAttribute||"_id"}})}});
