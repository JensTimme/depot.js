// depot.js v0.1.2 | (c) 2013 Michal Kuklis | Licensed under The MIT License
(function(e,g,d){"object"===typeof exports?module.exports=d():"function"===typeof define&&define.amd?define(d):g[e]=d()})("depot",this,function(){function e(a){return a&&JSON.parse(a)}function g(a,b){var c,f;if("function"==typeof a)c=a(b);else for(f in c=!0,a)c&=a[f]===b[f];return c}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var j={save:function(a){var b;a[this.idAttribute]||(a[this.idAttribute]=
d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d());b=a[this.idAttribute];0<=this.ids.indexOf(b)?a=h(this.get(b),a):(this.ids.push(b),localStorage.setItem(this.name,this.ids.join(",")));localStorage.setItem(this.name+"-"+b,JSON.stringify(a));return a},updateAll:function(a){var b=this.all();b.forEach(function(b){b=h(b,a);this.save(b)},this);return b},find:function(a){var b,c,f=this.name;return!a?this.all():this.ids.reduce(function(d,h){c=e(localStorage.getItem(f+"-"+h));(b=g(a,c))&&d.push(c);return d},
[])},get:function(a){return e(localStorage.getItem(this.name+"-"+a))},all:function(){var a,b=this.name;return this.ids.reduce(function(c,d){(a=localStorage.getItem(b+"-"+d))&&c.push(e(a));return c},[])},destroy:function(a){var b;b=a[this.idAttribute]?a[this.idAttribute]:a;var c=this.name+"-"+b;a=e(localStorage.getItem(c));localStorage.removeItem(c);b=this.ids.indexOf(b);-1!=b&&this.ids.splice(b,1);localStorage.setItem(this.name,this.ids.join(","));return a},destroyAll:function(a){for(var b,c,d=this.ids.length-
1;0<=d;d--)if(b=this.ids[d],b=this.name+"-"+b,a){if(c=e(localStorage.getItem(b)),c=g(a,c))localStorage.removeItem(b),this.ids.splice(d,1)}else localStorage.removeItem(b);a?localStorage.setItem(this.name,this.ids.join(",")):(localStorage.removeItem(this.name),this.ids=[])}};return function(a,b){var c,d;if(!localStorage)throw Error("localStorage not found");d=(c=localStorage.getItem(a))&&c.split(",")||[];b=b||{};return Object.create(j,{name:{value:a},store:{value:c},ids:{value:d,writable:!0},idAttribute:{value:b.idAttribute||
"_id"}})}});
